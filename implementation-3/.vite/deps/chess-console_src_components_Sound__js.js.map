{
  "version": 3,
  "sources": ["../../node_modules/cm-web-modules/src/audio/Audio.js", "../../node_modules/cm-web-modules/src/audio/Sample.js", "../../node_modules/cm-web-modules/src/audio/AudioSprite.js", "../../node_modules/chess-console/src/components/Sound.js"],
  "sourcesContent": ["/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-web-modules\n * License: MIT, see file 'LICENSE'\n */\nconst events = ['click', 'touchstart', 'touchend', 'keydown', 'mousedown', 'mouseup', 'dblclick']\nlet audioProps = undefined\nwindow.cmAudioDebug = false\n\nexport const createAudioContext = (props) => {\n    audioProps = {\n        debug: false,\n        ...props\n    }\n    window.cmAudioDebug = audioProps.debug\n    window.AudioContext = window.AudioContext || window.webkitAudioContext\n    if (window.AudioContext) {\n        if (audioProps.debug) {\n            console.log('Web Audio API (AudioContext) supported by this browser')\n        }\n        window.cmAudioContext = new AudioContext()\n    } else if (window.webkitAudioContext) {\n        if (audioProps.debug) {\n            console.log('Web Audio API (window.webkitAudioContext) supported by this browser')\n        }\n        window.cmAudioContext = new webkitAudioContext()\n    } else {\n        console.error('Web Audio API is not supported by this browser')\n    }\n    window.cmMainGainNode = window.cmAudioContext.createGain()\n    window.cmMainGainNode.gain.value = 1\n    cmMainGainNode.connect(window.cmAudioContext.destination)\n    addEventListeners()\n}\n\nexport class Audio {\n\n    static context() {\n        if (!window.cmAudioContext) {\n            console.error(\"Audio.context() called before createAudioContext()\")\n        }\n        return window.cmAudioContext\n    }\n\n    static destination() {\n        return window.cmMainGainNode\n    }\n\n    static setGain(gain) {\n        window.cmMainGainNode.gain.setValueAtTime(gain, window.cmAudioContext.currentTime)\n    }\n\n    static isEnabled() {\n        return window.cmAudioContext.state === \"running\"\n    }\n\n    /*\n        Adds an event listener to the audioContext object\n        that listens for the \"statechange\" event. This event is triggered whenever the state of the AudioContext changes\n        (e.g., from \"suspended\" to \"running\" or vice versa). The listener function will be called whenever this event occurs,\n        allowing you to execute custom code in response to changes in the AudioContext state.\n     */\n    static addStateListener(listener) {\n        window.cmAudioContext.addEventListener(\"statechange\", listener)\n    }\n\n    /*\n        can be called from the UI to resume the AudioContext after user interaction\n     */\n    static resumeAudioContext() {\n        resumeAudioContext()\n    }\n\n}\n\n\nfunction addEventListeners() {\n    events.forEach(event => {\n        document.addEventListener(event, resumeAudioContext)\n    })\n    document.addEventListener('visibilitychange', () => {\n        if (!document.hidden) {\n            setTimeout(resumeAudioContext, 200)\n        }\n    })\n}\n\nfunction removeEventListeners() {\n    events.forEach(event => {\n        document.removeEventListener(event, resumeAudioContext)\n    })\n}\n\n// start context after user interaction\nfunction resumeAudioContext() {\n    if (window.cmAudioContext) {\n        if (window.cmAudioContext.state !== \"running\") {\n            window.cmAudioContext.resume().then(() => {\n                if (audioProps.debug) {\n                    console.log('AudioContext resumed successfully, state:', window.cmAudioContext.state)\n                }\n                removeEventListeners()\n            }).catch(error => {\n                console.error('Failed to resume AudioContext:', error)\n            })\n        } else {\n            console.warn('AudioContext already running')\n            removeEventListeners()\n        }\n    } else {\n        console.error(\"AudioContext not created\")\n    }\n\n}\n", "/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-web-modules\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Audio} from \"./Audio.js\"\n\nexport class Sample {\n\n    constructor(src, props = {}) {\n        this.src = src\n        this.props = {\n            gain: 1,\n            startWithoutAudioContext: true // start to play, without enabled audio context\n        }\n        Object.assign(this.props, props)\n        this.gainNode = Audio.context().createGain()\n        this.setGain(this.props.gain)\n        this.audioBuffer = null\n        this.load()\n    }\n\n    setGain(gain) {\n        if(window.cmAudioDebug) {\n            console.log(\"Sample.setGain\", gain)\n        }\n        this.gainNode.gain.setValueAtTime(gain, Audio.context().currentTime)\n    }\n\n    play(when = undefined, offset = undefined, duration = undefined) {\n        if(window.cmAudioDebug) {\n            console.log(\"Sample.play\", this.src, when, offset, duration)\n        }\n        if (this.props.startWithoutAudioContext || Audio.isEnabled()) {\n            this.loading.then(() => {\n                let source\n                source = this.createBufferSource()\n                source.start(when, offset, duration)\n            })\n        }\n\n    }\n\n    createBufferSource() {\n        const source = Audio.context().createBufferSource()\n        source.buffer = this.audioBuffer\n        source.connect(this.gainNode)\n        this.gainNode.connect(Audio.destination())\n        return source\n    }\n\n    load() {\n        this.loading = new Promise(((resolve, reject) => {\n            const request = new XMLHttpRequest()\n            request.open('GET', this.src, true)\n            request.responseType = 'arraybuffer'\n            request.onload = () => {\n                Audio.context().decodeAudioData(request.response, (audioBuffer) => {\n                    this.audioBuffer = audioBuffer\n                    resolve()\n                }, () => {\n                    console.error(\"error loading sound\", this.src)\n                    reject()\n                })\n            }\n            request.send()\n        }))\n        return this.loading\n    }\n\n}\n", "/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-web-modules\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Sample} from \"./Sample.js\"\n\nexport class AudioSprite extends Sample {\n\n    // noinspection JSCheckFunctionSignatures\n    play(sliceName, when = 0) {\n        this.playSlice(sliceName, when)\n    }\n\n    playSlice(sliceName, when = 0) {\n        const slice = this.props.slices[sliceName]\n        if (!slice) {\n            throw new Error(`slice ${sliceName} not found in sprite`)\n        }\n        super.play(when, slice.offset, slice.duration)\n    }\n\n}\n", "/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/chess-console\n * License: MIT, see file 'LICENSE'\n */\n\nimport {AudioSprite} from \"cm-web-modules/src/audio/AudioSprite.js\"\nimport {Component} from \"cm-web-modules/src/app/Component.js\"\nimport {CONSOLE_MESSAGE_TOPICS} from \"../ChessConsole.js\"\nimport {createAudioContext} from \"cm-web-modules/src/audio/Audio.js\"\n\nexport class Sound extends Component {\n\n    constructor(chessConsole, props) {\n        super(props)\n        createAudioContext()\n        this.chessConsole = chessConsole\n        this.audioSprite = new AudioSprite(this.props.soundSpriteFile,\n            {\n                gain: 1,\n                slices: {\n                    \"game_start\": {offset: 0, duration: 0.9},\n                    \"game_won\": {offset: 0.9, duration: 1.8},\n                    \"game_lost\": {offset: 2.7, duration: 0.9},\n                    \"game_draw\": {offset: 9.45, duration: 1.35},\n                    \"check\": {offset: 3.6, duration: 0.45},\n                    \"wrong_move\": {offset: 4.05, duration: 0.45},\n                    \"move\": {offset: 4.5, duration: 0.2},\n                    \"capture\": {offset: 6.3, duration: 0.2},\n                    \"castle\": {offset: 7.65, duration: 0.2},\n                    \"take_back\": {offset: 8.1, duration: 0.12},\n                    \"promotion\": {offset: 9.0, duration: 0.45},\n                    \"dialog\": {offset: 10.8, duration: 0.45}\n                }\n            })\n        chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.initGame, () => {\n            // this.play(\"game_start\")\n        })\n        chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.legalMove, (data) => {\n            const chess = this.chessConsole.state.chess\n            const flags = data.moveResult.flags\n            if (flags.indexOf(\"p\") !== -1) {\n                this.play(\"promotion\")\n            } else if (flags.indexOf(\"c\") !== -1) {\n                this.play(\"capture\")\n            } else if (flags.indexOf(\"k\") !== -1 || flags.indexOf(\"q\") !== -1) {\n                this.play(\"castle\")\n            } else {\n                clearInterval(this.moveDebounced)\n                this.moveDebounced = setTimeout(() => {\n                    this.play(\"move\")\n                }, 10)\n            }\n            if (chess.inCheck() || chess.inCheckmate()) {\n                this.play(\"check\")\n            }\n        })\n        chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.illegalMove, () => {\n            this.play(\"wrong_move\")\n        })\n        chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.moveUndone, () => {\n            this.play(\"take_back\")\n        })\n        chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.gameOver, (data) => {\n            setTimeout(() => {\n                if(!data.wonColor) {\n                    this.play(\"game_lost\")\n                } else {\n                    if(data.wonColor === this.chessConsole.props.playerColor) {\n                        this.play(\"game_won\")\n                    } else {\n                        this.play(\"game_lost\")\n                    }\n                }\n            }, 500)\n        })\n        chessConsole.sound = this\n    }\n\n    play(soundName) {\n        this.audioSprite.play(soundName)\n    }\n\n}\n"],
  "mappings": "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",
  "names": []
}
