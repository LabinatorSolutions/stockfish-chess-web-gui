{
  "version": 3,
  "sources": ["../../node_modules/cm-chessboard/src/extensions/markers/Markers.js"],
  "sourcesContent": ["/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\nimport {Extension, EXTENSION_POINT} from \"../../model/Extension.js\"\nimport {Svg} from \"../../lib/Svg.js\"\nimport {INPUT_EVENT_TYPE} from \"../../Chessboard.js\"\nimport {Utils} from \"../../lib/Utils.js\"\n\nexport const MARKER_TYPE = {\n    frame: {class: \"marker-frame\", slice: \"markerFrame\"},\n    framePrimary: {class: \"marker-frame-primary\", slice: \"markerFrame\"},\n    frameDanger: {class: \"marker-frame-danger\", slice: \"markerFrame\"},\n    circle: {class: \"marker-circle\", slice: \"markerCircle\"},\n    circlePrimary: {class: \"marker-circle-primary\", slice: \"markerCircle\"},\n    circleDanger: {class: \"marker-circle-danger\", slice: \"markerCircle\"},\n    circleDangerFilled: {class: \"marker-circle-danger-filled\", slice: \"markerCircleFilled\"},\n    square: {class: \"marker-square\", slice: \"markerSquare\"},\n    dot: {class: \"marker-dot\", slice: \"markerDot\", position: 'above'},\n    bevel: {class: \"marker-bevel\", slice: \"markerBevel\"}\n}\n\nexport class Markers extends Extension {\n\n    /** @constructor */\n    constructor(chessboard, props = {}) {\n        super(chessboard)\n        this.registerExtensionPoint(EXTENSION_POINT.afterRedrawBoard, () => {\n            this.onRedrawBoard()\n        })\n        this.props = {\n            autoMarkers: MARKER_TYPE.frame, // set to `null` to disable autoMarkers\n            sprite: \"extensions/markers/markers.svg\" // the sprite file of the markers\n        }\n        Object.assign(this.props, props)\n        if (chessboard.props.assetsCache) {\n            chessboard.view.cacheSpriteToDiv(\"cm-chessboard-markers\", this.getSpriteUrl())\n        }\n        chessboard.addMarker = this.addMarker.bind(this)\n        chessboard.getMarkers = this.getMarkers.bind(this)\n        chessboard.removeMarkers = this.removeMarkers.bind(this)\n        chessboard.addLegalMovesMarkers = this.addLegalMovesMarkers.bind(this)\n        chessboard.removeLegalMovesMarkers = this.removeLegalMovesMarkers.bind(this)\n        this.markerGroupDown = Svg.addElement(chessboard.view.markersLayer, \"g\", {class: \"markers\"})\n        this.markerGroupUp = Svg.addElement(chessboard.view.markersTopLayer, \"g\", {class: \"markers\"})\n        this.markers = []\n        if (this.props.autoMarkers) {\n            Object.assign(this.props.autoMarkers, this.props.autoMarkers)\n            this.registerExtensionPoint(EXTENSION_POINT.moveInput, (event) => {\n                this.drawAutoMarkers(event)\n            })\n        }\n    }\n\n    drawAutoMarkers(event) {\n        if(event.type !== INPUT_EVENT_TYPE.moveInputFinished) {\n            this.removeMarkers(this.props.autoMarkers)\n        }\n        if (event.type === INPUT_EVENT_TYPE.moveInputStarted &&\n            !event.moveInputCallbackResult) {\n            return\n        }\n        if (event.type === INPUT_EVENT_TYPE.moveInputStarted ||\n            event.type === INPUT_EVENT_TYPE.movingOverSquare) {\n            if (event.squareFrom) {\n                this.addMarker(this.props.autoMarkers, event.squareFrom)\n            }\n            if (event.squareTo) {\n                this.addMarker(this.props.autoMarkers, event.squareTo)\n            }\n        }\n    }\n\n    onRedrawBoard() {\n        while (this.markerGroupUp.firstChild) {\n            this.markerGroupUp.removeChild(this.markerGroupUp.firstChild)\n        }\n        while (this.markerGroupDown.firstChild) {\n            this.markerGroupDown.removeChild(this.markerGroupDown.firstChild)\n        }\n        this.markers.forEach((marker) => {\n                this.drawMarker(marker)\n            }\n        )\n    }\n\n    addLegalMovesMarkers(moves) {\n        for (const move of moves) {\n            if (move.promotion && move.promotion !== \"q\") {\n                continue\n            }\n            if (this.chessboard.getPiece(move.to)) {\n                this.chessboard.addMarker(MARKER_TYPE.bevel, move.to)\n            } else {\n                this.chessboard.addMarker(MARKER_TYPE.dot, move.to)\n            }\n        }\n    }\n\n    removeLegalMovesMarkers() {\n        this.chessboard.removeMarkers(MARKER_TYPE.bevel)\n        this.chessboard.removeMarkers(MARKER_TYPE.dot)\n    }\n\n    drawMarker(marker) {\n        let markerGroup\n        if (marker.type.position === 'above') {\n            markerGroup = Svg.addElement(this.markerGroupUp, \"g\")\n        } else {\n            markerGroup = Svg.addElement(this.markerGroupDown, \"g\")\n        }\n        markerGroup.setAttribute(\"data-square\", marker.square)\n        const point = this.chessboard.view.squareToPoint(marker.square)\n        const transform = (this.chessboard.view.svg.createSVGTransform())\n        transform.setTranslate(point.x, point.y)\n        markerGroup.transform.baseVal.appendItem(transform)\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.getSpriteUrl()\n        const markerUse = Svg.addElement(markerGroup, \"use\",\n            {href: `${spriteUrl}#${marker.type.slice}`, class: \"marker \" + marker.type.class})\n        const transformScale = (this.chessboard.view.svg.createSVGTransform())\n        transformScale.setScale(this.chessboard.view.scalingX, this.chessboard.view.scalingY)\n        markerUse.transform.baseVal.appendItem(transformScale)\n        return markerGroup\n    }\n\n    addMarker(type, square) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `addMarker` to `(type, square)` with v5.1.x\")\n            return\n        }\n        this.markers.push(new Marker(square, type))\n        this.onRedrawBoard()\n    }\n\n    getMarkers(type = undefined, square = undefined) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `getMarkers` to `(type, square)` with v5.1.x\")\n            return\n        }\n        let markersFound = []\n        this.markers.forEach((marker) => {\n            if (marker.matches(square, type)) {\n                markersFound.push(marker)\n            }\n        })\n        return markersFound\n    }\n\n    removeMarkers(type = undefined, square = undefined) {\n        if (typeof type === \"string\" || typeof square === \"object\") { // todo remove 2022-12-01\n            console.error(\"changed the signature of `removeMarkers` to `(type, square)` with v5.1.x\")\n            return\n        }\n        this.markers = this.markers.filter((marker) => !marker.matches(square, type))\n        this.onRedrawBoard()\n    }\n\n    getSpriteUrl() {\n        if(Utils.isAbsoluteUrl(this.props.sprite)) {\n            return this.props.sprite\n        } else {\n            return this.chessboard.props.assetsUrl + this.props.sprite\n        }\n    }\n}\n\nclass Marker {\n    constructor(square, type) {\n        this.square = square\n        this.type = type\n    }\n\n    matches(square = undefined, type = undefined) {\n        if (!type && !square) {\n            return true\n        } else if (!type) {\n            if (square === this.square) {\n                return true\n            }\n        } else if (!square) {\n            if (this.type === type) {\n                return true\n            }\n        } else if (this.type === type && square === this.square) {\n            return true\n        }\n        return false\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
