{
  "version": 3,
  "sources": ["../../node_modules/cm-chessboard/src/extensions/arrows/Arrows.js"],
  "sourcesContent": ["/**\n * Authors and copyright: Barak Michener (@barakmich) and Stefan Haack (@shaack)\n * Repository: https://github.com/shaack/cm-chessboard\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Extension, EXTENSION_POINT} from \"../../model/Extension.js\"\nimport {Svg} from \"../../lib/Svg.js\"\nimport {Utils} from \"../../lib/Utils.js\"\n\nexport const ARROW_TYPE = {\n    default: {class: \"arrow-success\"},\n    success: {class: \"arrow-success\"},\n    warning: {class: \"arrow-warning\"},\n    info: {class: \"arrow-info\"},\n    danger: {class: \"arrow-danger\"}\n}\n\nexport class Arrows extends Extension {\n\n    /** @constructor */\n    constructor(chessboard, props = {}) {\n        super(chessboard)\n        this.registerExtensionPoint(EXTENSION_POINT.afterRedrawBoard, () => {\n            this.onRedrawBoard()\n        })\n        this.props = {\n            sprite: \"extensions/arrows/arrows.svg\",\n            slice: \"arrowDefault\",\n            headSize: 7,\n            offsetFrom: 0,\n            offsetTo: 0.55\n        }\n        Object.assign(this.props, props)\n        if (this.chessboard.props.assetsCache) {\n            this.chessboard.view.cacheSpriteToDiv(\"cm-chessboard-arrows\", this.getSpriteUrl())\n        }\n        chessboard.addArrow = this.addArrow.bind(this)\n        chessboard.getArrows = this.getArrows.bind(this)\n        chessboard.removeArrows = this.removeArrows.bind(this)\n        this.arrowGroup = Svg.addElement(chessboard.view.markersTopLayer, \"g\", {class: \"arrows\"})\n        this.arrows = []\n    }\n\n    onRedrawBoard() {\n        while (this.arrowGroup.firstChild) {\n            this.arrowGroup.removeChild(this.arrowGroup.firstChild)\n        }\n        this.arrows.forEach((arrow) => {\n            this.drawArrow(arrow)\n        })\n    }\n\n    drawArrow(arrow) {\n        const view = this.chessboard.view\n        const arrowsGroup = Svg.addElement(this.arrowGroup, \"g\")\n        arrowsGroup.setAttribute(\"data-arrow\", arrow.from + arrow.to)\n        arrowsGroup.setAttribute(\"class\", \"arrow \" + arrow.type.class)\n        const ptFrom = view.squareToPoint(arrow.from)\n        const ptTo = view.squareToPoint(arrow.to)\n        const spriteUrl = this.chessboard.props.assetsCache ? \"\" : this.getSpriteUrl()\n        const defs = Svg.addElement(arrowsGroup, \"defs\")\n        const id = \"arrow-\" + arrow.from + arrow.to\n        const marker = Svg.addElement(defs, \"marker\", {\n            id: id,\n            markerWidth: this.props.headSize,\n            markerHeight: this.props.headSize,\n            refX: 20,\n            refY: 20,\n            viewBox: \"0 0 40 40\",\n            orient: \"auto\",\n            class: \"arrow-head\",\n        })\n\n        Svg.addElement(marker, \"use\", {\n            href: `${spriteUrl}#${this.props.slice}`,\n        })\n\n        // Compute centers of start and end squares\n        const cx1 = ptFrom.x + view.squareWidth / 2\n        const cy1 = ptFrom.y + view.squareHeight / 2\n        const cx2 = ptTo.x + view.squareWidth / 2\n        const cy2 = ptTo.y + view.squareHeight / 2\n\n        // Offset the line so it starts/ends at the edge of an invisible circle inside each square\n        const dx = cx2 - cx1\n        const dy = cy2 - cy1\n        const len = Math.hypot(dx, dy) || 1\n        const ux = dx / len\n        const uy = dy / len\n        // compute radii from props: factor relative to half of the square size\n        const halfMin = Math.min(view.squareWidth, view.squareHeight) / 2\n        const clamp01 = (v) => Math.max(0, Math.min(1, v))\n        const rFrom = halfMin * clamp01(this.props.offsetFrom)\n        const rTo = halfMin * clamp01(this.props.offsetTo)\n        const x1 = cx1 + ux * rFrom\n        const y1 = cy1 + uy * rFrom\n        const x2 = cx2 - ux * rTo\n        const y2 = cy2 - uy * rTo\n\n        const width = ((view.scalingX + view.scalingY) / 2) * 8\n        let lineFill = Svg.addElement(arrowsGroup, \"line\")\n        lineFill.setAttribute('x1', x1.toString())\n        lineFill.setAttribute('x2', x2.toString())\n        lineFill.setAttribute('y1', y1.toString())\n        lineFill.setAttribute('y2', y2.toString())\n        lineFill.setAttribute('class', 'arrow-line')\n        lineFill.setAttribute(\"marker-end\", \"url(#\" + id + \")\")\n        lineFill.setAttribute('stroke-width', width + \"px\")\n    }\n\n    addArrow(type, from, to) {\n        this.arrows.push(new Arrow(from, to, type))\n        this.chessboard.view.redrawBoard()\n    }\n\n    getArrows(type = undefined, from = undefined, to = undefined) {\n        let arrows = []\n        this.arrows.forEach((arrow) => {\n            if (arrow.matches(from, to, type)) {\n                arrows.push(arrow)\n            }\n        })\n        return arrows\n    }\n\n    removeArrows(type = undefined, from = undefined, to = undefined) {\n        this.arrows = this.arrows.filter((arrow) => !arrow.matches(from, to, type))\n        this.chessboard.view.redrawBoard()\n    }\n\n    getSpriteUrl() {\n        if(Utils.isAbsoluteUrl(this.props.sprite)) {\n            return this.props.sprite\n        } else {\n            return this.chessboard.props.assetsUrl + this.props.sprite\n        }\n    }\n}\n\nclass Arrow {\n    constructor(from, to, type) {\n        this.from = from\n        this.to = to\n        this.type = type\n    }\n\n    matches(from = undefined, to = undefined, type = undefined) {\n        if (from && from !== this.from) {\n            return false\n        }\n        if (to && to !== this.to) {\n            return false\n        }\n        return !(type && type !== this.type)\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
