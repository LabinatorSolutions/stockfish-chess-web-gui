{
  "version": 3,
  "sources": ["../../node_modules/chess-console/src/components/CapturedPieces.js"],
  "sourcesContent": ["/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/chess-console\n * License: MIT, see file 'LICENSE'\n */\n\nimport {Observe} from \"cm-web-modules/src/observe/Observe.js\"\nimport {PIECES} from \"cm-chess/src/Chess.js\"\nimport {DomUtils} from \"cm-web-modules/src/utils/DomUtils.js\"\n\nconst zeroWithSpace = \"&#8203;\"\n\nexport class CapturedPieces {\n\n    constructor(chessConsole) {\n        this.chessConsole = chessConsole\n        this.element = document.createElement(\"div\")\n        this.element.setAttribute(\"class\", \"captured-pieces\")\n        this.chessConsole.componentContainers.left.querySelector(\".chess-console-captured\").appendChild(this.element)\n        this.chessConsole.state.observeChess(() => {\n            this.redraw()\n        })\n        Observe.property(this.chessConsole.state, \"plyViewed\", () => {\n            this.redraw()\n        })\n        Observe.property(this.chessConsole.state, \"orientation\", () => {\n            this.redraw()\n        })\n        this.i18n = chessConsole.i18n\n        this.i18n.load({\n            \"de\": {\n                \"captured_pieces\": \"Geschlagene Figuren\"\n            },\n            \"en\": {\n                \"captured_pieces\": \"Captured pieces\"\n            }\n        }).then(() => {\n            this.redraw()\n        })\n        DomUtils.delegate(this.element, \"click\", \".piece\", (event) => {\n            const ply = event.target.getAttribute(\"data-ply\")\n            this.chessConsole.state.plyViewed = parseInt(ply, 10)\n        })\n    }\n\n    redraw() {\n        window.clearTimeout(this.redrawDebounce)\n        this.redrawDebounce = setTimeout(() => {\n            const capturedPiecesWhite = []\n            const capturedPiecesWhiteAfterPlyViewed = []\n            const capturedPiecesBlack = []\n            const capturedPiecesBlackAfterPlyViewed = []\n\n            const history = this.chessConsole.state.chess.history({verbose: true})\n            let pointsWhite = 0\n            let pointsBlack = 0\n            history.forEach((move, index) => {\n                if (move.flags.indexOf(\"c\") !== -1 || move.flags.indexOf(\"e\") !== -1) {\n                    const pieceCaptured = move.captured.toUpperCase()\n                    if (move.color === \"b\") {\n                        const pieceHtml = `<span class=\"piece\" role='button' data-ply='${move.ply}'>` + this.chessConsole.props.figures[pieceCaptured + \"w\"] + \"</span>\"\n                        if (index < this.chessConsole.state.plyViewed) {\n                            capturedPiecesWhite.push(pieceHtml)\n                        } else {\n                            capturedPiecesWhiteAfterPlyViewed.push(pieceHtml)\n                        }\n                        pointsWhite += PIECES[pieceCaptured.toLowerCase()].value\n                    } else if (move.color === \"w\") {\n                        const pieceHtml = `<span class=\"piece\" role='button' data-ply='${move.ply}'>`  + this.chessConsole.props.figures[pieceCaptured + \"b\"] + \"</span>\"\n                        if (index < this.chessConsole.state.plyViewed) {\n                            capturedPiecesBlack.push(pieceHtml)\n                        } else {\n                            capturedPiecesBlackAfterPlyViewed.push(pieceHtml)\n                        }\n                        pointsBlack += PIECES[pieceCaptured.toLowerCase()].value\n                    }\n                }\n            })\n            const outputWhite = this.renderPieces(capturedPiecesWhite, capturedPiecesWhiteAfterPlyViewed, pointsWhite)\n            const outputBlack = this.renderPieces(capturedPiecesBlack, capturedPiecesBlackAfterPlyViewed, pointsBlack)\n            this.element.innerHTML = \"<h2 class='visually-hidden'>\" + this.i18n.t(\"captured_pieces\") + \"</h2>\" +\n                (this.chessConsole.state.orientation === \"w\" ? outputWhite + outputBlack : outputBlack + outputWhite)\n        })\n    }\n\n    renderPieces(capturedPieces, capturedPiecesAfterPlyViewed, points) {\n        let output = \"<div>\"\n        if (capturedPieces.length > 0) {\n            output += capturedPieces.join(zeroWithSpace)\n        }\n        if (capturedPiecesAfterPlyViewed.length > 0) {\n            output += \"<span class='text-muted'>\" + capturedPiecesAfterPlyViewed.join(zeroWithSpace) + \"</span>\"\n        }\n        output += \"<small> \" + (points > 0 ? points : \"\") + \"</small></div>\"\n        return output\n    }\n\n\n}\n"],
  "mappings": "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",
  "names": []
}
