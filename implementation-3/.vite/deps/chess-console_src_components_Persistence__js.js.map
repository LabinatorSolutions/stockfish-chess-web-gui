{
  "version": 3,
  "sources": ["../../node_modules/chess-console/src/components/Persistence.js"],
  "sourcesContent": ["/**\n * Author and copyright: Stefan Haack (https://shaack.com)\n * Repository: https://github.com/shaack/chess-console\n * License: MIT, see file 'LICENSE'\n */\nimport {COLOR} from \"cm-chess/src/Chess.js\"\nimport {Component} from \"cm-web-modules/src/app/Component.js\"\nimport {CONSOLE_MESSAGE_TOPICS} from \"../ChessConsole.js\"\n\nexport class Persistence extends Component {\n\n    constructor(chessConsole, props) {\n        super(props)\n        this.chessConsole = chessConsole\n        if(!this.props.savePrefix) {\n            this.props.savePrefix = \"ChessConsole\"\n        }\n        this.chessConsole.state.observeChess(() => {\n            this.save()\n        })\n        this.chessConsole.messageBroker.subscribe(CONSOLE_MESSAGE_TOPICS.newGame, () => {\n            this.save()\n        })\n        this.chessConsole.persistence = this\n    }\n\n    load(prefix = this.props.savePrefix) {\n        const props = {}\n        try {\n            if (this.loadValue(\"PlayerColor\") !== null) {\n                props.playerColor = this.loadValue(\"PlayerColor\")\n            } else {\n                props.playerColor = COLOR.white\n            }\n            if (localStorage.getItem(prefix + \"Pgn\") !== null) {\n                props.pgn = localStorage.getItem(prefix + \"Pgn\")\n            }\n            this.chessConsole.messageBroker.publish(CONSOLE_MESSAGE_TOPICS.load)\n            this.chessConsole.initGame(props)\n        } catch (e) {\n            localStorage.clear()\n            console.warn(e)\n            this.chessConsole.initGame({playerColor: COLOR.white})\n        }\n    }\n\n    loadValue(valueName, prefix = this.props.savePrefix) {\n        let item = null\n        try {\n            item = localStorage.getItem(prefix + valueName)\n            return JSON.parse(item)\n        } catch (e) {\n            console.error(\"error loading \", prefix + valueName)\n            console.error(\"item:\" + item)\n            console.error(e)\n        }\n    }\n\n    save(prefix = this.props.savePrefix) {\n        localStorage.setItem(prefix + \"PlayerColor\", JSON.stringify(this.chessConsole.props.playerColor))\n        localStorage.setItem(prefix + \"Pgn\", this.chessConsole.state.chess.renderPgn())\n    }\n\n    saveValue(valueName, value, prefix = this.props.savePrefix) {\n        localStorage.setItem(prefix + valueName, JSON.stringify(value))\n    }\n\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AASO,IAAM,cAAN,cAA0B,UAAU;AAAA,EAEvC,YAAY,cAAc,OAAO;AAC7B,UAAM,KAAK;AACX,SAAK,eAAe;AACpB,QAAG,CAAC,KAAK,MAAM,YAAY;AACvB,WAAK,MAAM,aAAa;AAAA,IAC5B;AACA,SAAK,aAAa,MAAM,aAAa,MAAM;AACvC,WAAK,KAAK;AAAA,IACd,CAAC;AACD,SAAK,aAAa,cAAc,UAAU,uBAAuB,SAAS,MAAM;AAC5E,WAAK,KAAK;AAAA,IACd,CAAC;AACD,SAAK,aAAa,cAAc;AAAA,EACpC;AAAA,EAEA,KAAK,SAAS,KAAK,MAAM,YAAY;AACjC,UAAM,QAAQ,CAAC;AACf,QAAI;AACA,UAAI,KAAK,UAAU,aAAa,MAAM,MAAM;AACxC,cAAM,cAAc,KAAK,UAAU,aAAa;AAAA,MACpD,OAAO;AACH,cAAM,cAAc,MAAM;AAAA,MAC9B;AACA,UAAI,aAAa,QAAQ,SAAS,KAAK,MAAM,MAAM;AAC/C,cAAM,MAAM,aAAa,QAAQ,SAAS,KAAK;AAAA,MACnD;AACA,WAAK,aAAa,cAAc,QAAQ,uBAAuB,IAAI;AACnE,WAAK,aAAa,SAAS,KAAK;AAAA,IACpC,SAAS,GAAG;AACR,mBAAa,MAAM;AACnB,cAAQ,KAAK,CAAC;AACd,WAAK,aAAa,SAAS,EAAC,aAAa,MAAM,MAAK,CAAC;AAAA,IACzD;AAAA,EACJ;AAAA,EAEA,UAAU,WAAW,SAAS,KAAK,MAAM,YAAY;AACjD,QAAI,OAAO;AACX,QAAI;AACA,aAAO,aAAa,QAAQ,SAAS,SAAS;AAC9C,aAAO,KAAK,MAAM,IAAI;AAAA,IAC1B,SAAS,GAAG;AACR,cAAQ,MAAM,kBAAkB,SAAS,SAAS;AAClD,cAAQ,MAAM,UAAU,IAAI;AAC5B,cAAQ,MAAM,CAAC;AAAA,IACnB;AAAA,EACJ;AAAA,EAEA,KAAK,SAAS,KAAK,MAAM,YAAY;AACjC,iBAAa,QAAQ,SAAS,eAAe,KAAK,UAAU,KAAK,aAAa,MAAM,WAAW,CAAC;AAChG,iBAAa,QAAQ,SAAS,OAAO,KAAK,aAAa,MAAM,MAAM,UAAU,CAAC;AAAA,EAClF;AAAA,EAEA,UAAU,WAAW,OAAO,SAAS,KAAK,MAAM,YAAY;AACxD,iBAAa,QAAQ,SAAS,WAAW,KAAK,UAAU,KAAK,CAAC;AAAA,EAClE;AAEJ;",
  "names": []
}
